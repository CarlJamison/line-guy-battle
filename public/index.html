<!DOCTYPE html>
<html>
  <meta name="viewport" content="width=device-width, user-scalable=0" />
  <head>
    <title>Game Controller</title>
  </head>
  <body>
    <script src="/nipplejs.js"></script>
    <script src="/socket.io/socket.io.js"></script>
    <style>
      button.grid-item{
        width: 70%; height: 70%;
        touch-action: manipulation;
        border: none; border-radius: 5px;
        top: 15%; position: relative; left: 15%;
      }
      #jump_button{
        background-color: blue;
      }
      #fire_button{
        background-color: red;
      }
      #utility_button{
        background-color: green;
      }
      #special_button{
        background-color: yellow;
      }
    </style>
    <div style="width: 50%; height: 100%; position: fixed; display: grid; grid-template-columns: auto auto auto">
      <div></div>
      <button id="jump_button" class="grid-item"></button>
      <div></div>
      <button id="special_button" class="grid-item"></button>
      <div></div>
      <button id="utility_button" class="grid-item"></button>
      <div></div>
      <button id="fire_button" class="grid-item"></button>
      <div></div>
    </div>
    <div id="zone_joystick" style="left: 50%; width: 50%; height: 100%; position: absolute;"></div>
    <script>

      var options = {
        zone: document.getElementById('zone_joystick'),
        color: "red", size: 250,
        position: {left: '50%', top: '50%'},        // preset position for 'static' mode
        mode: 'static',
      };
      var manager = nipplejs.create(options);

      var socket = io("/controller");

      manager.on('move', function (evt, data) {
        socket.emit('direction change', { radians: data.angle.radian, vector: data.vector });
      });

      manager.on('end', function (evt, data) {
        socket.emit('direction change', { radians: 0, vector: { x: 0, y: 0 } });
      });

      document.getElementById("fire_button").ontouchstart = () => buttonPress(0);
      document.getElementById("jump_button").ontouchstart = () => buttonPress(1);
      document.getElementById("utility_button").ontouchstart = () => buttonPress(2);

      function buttonPress(action){
        window.navigator.vibrate(10);
        socket.emit('fire', action);
      }
    </script>
  </body>
</html>
